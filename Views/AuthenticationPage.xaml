<ContentPage
    x:Class="SnapLabel.Views.AuthenticationPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:buttons="clr-namespace:Syncfusion.Maui.Buttons;assembly=Syncfusion.Maui.Buttons"
    xmlns:constant="clr-namespace:SnapLabel.Constants"
    xmlns:sfPopup="clr-namespace:Syncfusion.Maui.Popup;assembly=Syncfusion.Maui.Popup"
    xmlns:sync="clr-namespace:Syncfusion.Maui.Core;assembly=Syncfusion.Maui.Core"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    xmlns:vm="clr-namespace:SnapLabel.ViewModels"
    x:Name="authPage"
    x:DataType="vm:AuthenticationPageViewModel"
    NavigationPage.HasNavigationBar="False">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior
            BindingContext="{Binding Path=BindingContext, Source={x:Reference authPage}, x:DataType=ContentPage}"
            Command="{Binding CheckAuthCommand}"
            EventName="NavigatedTo" />
    </ContentPage.Behaviors>

    <Grid RowDefinitions="150,*">

        <Image
            Margin="0,40,0,20"
            Aspect="AspectFit"
            HorizontalOptions="Center"
            MaximumHeightRequest="150"
            Source="cloud.png"
            VerticalOptions="Center" />


        <VerticalStackLayout
            Grid.Row="1"
            Padding="30"
            Spacing="20">

            <!--  Email Entry  -->
            <sync:SfTextInputLayout Hint="Email">
                <Entry Keyboard="Email" Text="{x:Binding UserVM.Email}" />
            </sync:SfTextInputLayout>

            <!--  Password Entry  -->
            <sync:SfTextInputLayout EnablePasswordVisibilityToggle="True" Hint="Password">
                <Entry
                    Margin="0,10"
                    IsPassword="True"
                    Text="{x:Binding UserVM.Password}" />
            </sync:SfTextInputLayout>

            <!--  Create Account Label  -->
            <Label
                FontAttributes="Bold"
                FontSize="14"
                HorizontalOptions="Center"
                HorizontalTextAlignment="Center"
                Text="Don't have an account? Create one"
                TextColor="#2882D1">
                <Label.GestureRecognizers>
                    <TapGestureRecognizer Command="{x:Binding OpenCreateAccountPopUpCommand}" />
                </Label.GestureRecognizers>
            </Label>

            <!--  Login Button  -->
            <Button
                Margin="0,20,0,0"
                Command="{Binding LoginCommand}"
                Style="{StaticResource LoginButtonStyle}"
                Text="Login" />

            <sfPopup:SfPopup
                Margin="{OnIdiom Phone=20,
                                 Desktop=0}"
                Padding="20"
                AnimationMode="Zoom"
                AutoSizeMode="Both"
                IsOpen="{x:Binding IsCreatingAccountPopUpOpen}"
                ShowHeader="False"
                StaysOpen="True">

                <sfPopup:SfPopup.PopupStyle>
                    <sfPopup:PopupStyle CornerRadius="16" PopupBackground="{AppThemeBinding Dark='#232323', Light={StaticResource White}}" />
                </sfPopup:SfPopup.PopupStyle>

                <sfPopup:SfPopup.ContentTemplate>
                    <DataTemplate x:DataType="vm:AuthenticationPageViewModel">
                        <VerticalStackLayout Padding="16" Spacing="12">

                            <Label
                                FontAttributes="Bold"
                                FontSize="18"
                                HorizontalOptions="Center"
                                Text="Create Account"
                                TextColor="#2882D1" />

                            <sync:SfTextInputLayout Hint="Username">
                                <Entry Text="{Binding UserVM.Username}" />
                            </sync:SfTextInputLayout>

                            <sync:SfTextInputLayout Hint="Email">
                                <Entry Text="{Binding UserVM.Email}" />
                            </sync:SfTextInputLayout>

                            <sync:SfTextInputLayout EnablePasswordVisibilityToggle="True" Hint="Password">
                                <Entry Text="{Binding UserVM.Password}" />
                            </sync:SfTextInputLayout>


                            <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                                <Button Command="{x:Binding CreateAccountCommand, x:DataType=vm:AuthenticationPageViewModel}" Text="Create Account" />
                                <Button
                                    Grid.Column="1"
                                    Command="{x:Binding CancelCommand,
                                                        x:DataType=vm:AuthenticationPageViewModel}"
                                    Text="Cancel" />
                            </Grid>

                        </VerticalStackLayout>
                    </DataTemplate>
                </sfPopup:SfPopup.ContentTemplate>
            </sfPopup:SfPopup>
        </VerticalStackLayout>
    </Grid>
</ContentPage>
